<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Learning Journal</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8f4e9;
            color: #3a3a3a;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #fffbf5;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            padding: 20px;
            border: 1px solid #e0d6c2;
        }
        
        h1, h2, h3 {
            color: #5a4a3a;
            font-family: 'Georgia', serif;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #d4c9b8;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #e8e0d0;
            border: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            color: #5a4a3a;
            transition: all 0.3s ease;
            margin-bottom: 5px;
        }
        
        .tab:hover {
            background-color: #d4c9b8;
        }
        
        .tab.active {
            background-color: #8b7d65;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Calendar Styles */
        .calendar {
            width: 100%;
            border-collapse: collapse;
        }
        
        .calendar th {
            background-color: #8b7d65;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: normal;
        }
        
        .calendar td {
            border: 1px solid #d4c9b8;
            height: 100px;
            vertical-align: top;
            padding: 5px;
            position: relative;
            background-color: #fffbf5;
        }
        
        .calendar .date {
            font-weight: bold;
            margin-bottom: 5px;
            color: #5a4a3a;
        }
        
        .calendar .other-month {
            background-color: #f8f4e9;
            color: #a8a094;
        }
        
        .calendar .today {
            background-color: #e8e0d0;
            border: 2px solid #8b7d65;
        }
        
        .calendar-entry {
            font-size: 12px;
            border-radius: 3px;
            padding: 2px 5px;
            margin-bottom: 2px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: pointer;
            position: relative;
        }
        
        .calendar-entry.TMUA {
            background-color: #a5c4b8;
            border-left: 3px solid #4a7a6a;
        }
        
        .calendar-entry.A-Level {
            background-color: #d4b8a5;
            border-left: 3px solid #8b5a3a;
        }
        
        .calendar-entry.R {
            background-color: #b8a5c4;
            border-left: 3px solid #6a4a7a;
        }
        
        .calendar-entry.Python {
            background-color: #a5b8c4;
            border-left: 3px solid #4a6a7a;
        }
        
        .calendar-entry.Other {
            background-color: #c4c4a5;
            border-left: 3px solid #7a7a4a;
        }
        
        .calendar-entry.Todo {
            background-color: #e8d4b8;
            border-left: 3px solid #8b7a4a;
        }
        
        .delete-entry {
            position: absolute;
            right: 2px;
            top: 2px;
            color: #5a4a3a;
            background: rgba(255,255,255,0.5);
            border-radius: 50%;
            width: 16px;
            height: 16px;
            text-align: center;
            line-height: 16px;
            font-size: 10px;
            display: none;
        }
        
        .calendar-entry:hover .delete-entry {
            display: block;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: #fffbf5;
            margin: 10% auto;
            padding: 20px;
            border-radius: 5px;
            width: 80%;
            max-width: 500px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            border: 1px solid #d4c9b8;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #d4c9b8;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .modal-title {
            font-size: 20px;
            color: #5a4a3a;
            margin: 0;
        }
        
        .close-modal {
            color: #8b7d65;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .modal-body {
            margin-bottom: 15px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            border-top: 1px solid #d4c9b8;
            padding-top: 15px;
        }
        
        /* Form Styles */
        .form-container {
            background-color: #f8f4e9;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #d4c9b8;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #5a4a3a;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #d4c9b8;
            border-radius: 4px;
            box-sizing: border-box;
            background-color: #fffbf5;
            color: #3a3a3a;
        }
        
        button {
            background-color: #8b7d65;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #6a5f4d;
        }
        
        button.secondary {
            background-color: #d4c9b8;
            color: #5a4a3a;
        }
        
        button.secondary:hover {
            background-color: #b8a99a;
        }
        
        /* Stats Styles */
        .stats-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .stat-card {
            flex: 1;
            min-width: 200px;
            background-color: #f8f4e9;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
            padding: 15px;
            border: 1px solid #d4c9b8;
        }
        
        .stat-card h3 {
            margin-top: 0;
            color: #5a4a3a;
            border-bottom: 1px solid #d4c9b8;
            padding-bottom: 10px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #8b7d65;
            margin: 10px 0;
        }
        
        .progress-bar {
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: #4a7a6a;
            border-radius: 10px;
        }
        
        .month-selector, .week-selector {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .month-title, .week-title {
            font-size: 20px;
            font-weight: bold;
            color: #5a4a3a;
        }
        
        /* Todo List Styles */
        .todo-container {
            background-color: #f8f4e9;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #d4c9b8;
        }
        
        .todo-list {
            list-style-type: none;
            padding: 0;
        }
        
        .todo-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background-color: #fffbf5;
            border-radius: 4px;
            margin-bottom: 8px;
            border: 1px solid #d4c9b8;
        }
        
        .todo-item input[type="checkbox"] {
            margin-right: 10px;
        }
        
        .todo-item .task {
            flex-grow: 1;
        }
        
        .todo-item .due-date {
            font-size: 12px;
            color: #8b7d65;
            margin-right: 10px;
        }
        
        .todo-item.completed .task {
            text-decoration: line-through;
            color: #a8a094;
        }
        
        .todo-item .delete-todo {
            color: #8b5a3a;
            cursor: pointer;
            margin-left: 10px;
        }
        
        /* Goals Styles */
        .goals-container {
            background-color: #f8f4e9;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #d4c9b8;
        }
        
        .goal-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #fffbf5;
            border-radius: 4px;
            border: 1px solid #d4c9b8;
        }
        
        .goal-item label {
            flex-grow: 1;
            margin-bottom: 0;
        }
        
        .goal-item input {
            width: 80px;
            margin-left: 10px;
        }
        
        /* Export Button */
        .export-btn {
            margin-top: 20px;
            background-color: #4a7a6a;
        }
        
        .export-btn:hover {
            background-color: #3a6a5a;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .calendar td {
                height: 70px;
                font-size: 12px;
            }
            
            .calendar-entry {
                font-size: 10px;
            }
            
            .stat-card {
                min-width: 100%;
            }
            
            .todo-item, .goal-item {
                flex-wrap: wrap;
            }
            
            .todo-item .due-date, .goal-item input {
                width: 100%;
                margin-top: 5px;
                margin-left: 25px;
            }
            
            .modal-content {
                width: 90%;
                margin: 20% auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>My Learning Journal</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="openTab('calendar')">Calendar</button>
            <button class="tab" onclick="openTab('add-entry')">Add Entry</button>
            <button class="tab" onclick="openTab('todo')">To-Do List</button>
            <button class="tab" onclick="openTab('stats')">Statistics</button>
            <button class="tab" onclick="openTab('goals')">Goals</button>
        </div>
        
        <!-- Calendar Tab -->
        <div id="calendar" class="tab-content active">
            <div class="month-selector">
                <button id="prev-month">&lt; Previous</button>
                <div class="month-title" id="current-month">Month Year</div>
                <button id="next-month">Next &gt;</button>
            </div>
            <table class="calendar" id="calendar-table">
                <thead>
                    <tr>
                        <th>Sunday</th>
                        <th>Monday</th>
                        <th>Tuesday</th>
                        <th>Wednesday</th>
                        <th>Thursday</th>
                        <th>Friday</th>
                        <th>Saturday</th>
                    </tr>
                </thead>
                <tbody id="calendar-body">
                    <!-- Calendar will be generated by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <!-- Add Entry Tab -->
        <div id="add-entry" class="tab-content">
            <div class="form-container">
                <h2>Add Study Entry</h2>
                <form id="entry-form">
                    <div class="form-group">
                        <label for="entry-date">Date</label>
                        <input type="date" id="entry-date" required>
                    </div>
                    <div class="form-group">
                        <label for="entry-subject">Subject</label>
                        <select id="entry-subject" required>
                            <option value="">Select a subject</option>
                            <option value="TMUA">TMUA</option>
                            <option value="A-Level">A Level</option>
                            <option value="R">R</option>
                            <option value="Python">Python</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group" id="other-subject-container" style="display: none;">
                        <label for="other-subject">Other Subject</label>
                        <input type="text" id="other-subject">
                    </div>
                    <div class="form-group">
                        <label for="entry-topic">Topic (optional)</label>
                        <input type="text" id="entry-topic">
                    </div>
                    <div class="form-group">
                        <label for="entry-duration">Duration (hours)</label>
                        <input type="number" id="entry-duration" min="0.1" step="0.1" required>
                    </div>
                    <button type="submit">Add Entry</button>
                </form>
            </div>
        </div>
        
        <!-- Todo List Tab -->
        <div id="todo" class="tab-content">
            <div class="todo-container">
                <h2>To-Do List</h2>
                <form id="todo-form">
                    <div class="form-group">
                        <label for="todo-task">Task</label>
                        <input type="text" id="todo-task" required>
                    </div>
                    <div class="form-group">
                        <label for="todo-due-date">Due Date</label>
                        <input type="date" id="todo-due-date" required>
                    </div>
                    <button type="submit">Add Task</button>
                </form>
                
                <ul class="todo-list" id="todo-list">
                    <!-- Todo items will be added here -->
                </ul>
            </div>
        </div>
        
        <!-- Statistics Tab -->
        <div id="stats" class="tab-content">
            <div class="tabs">
                <button class="tab active" onclick="openStatsTab('monthly')">Monthly</button>
                <button class="tab" onclick="openStatsTab('weekly')">Weekly</button>
            </div>
            
            <!-- Monthly Stats -->
            <div id="monthly-stats" class="stats-tab-content active">
                <h2>Monthly Study Statistics</h2>
                <div class="month-selector">
                    <button id="prev-month-stats">&lt; Previous</button>
                    <div class="month-title" id="current-month-stats">Month Year</div>
                    <button id="next-month-stats">Next &gt;</button>
                </div>
                <div class="stats-container">
                    <div class="stat-card">
                        <h3>Total Study Time</h3>
                        <div class="stat-value" id="total-hours">0 hours</div>
                        <div>this month</div>
                    </div>
                    <div class="stat-card">
                        <h3>Most Studied Subject</h3>
                        <div class="stat-value" id="top-subject">-</div>
                        <div id="top-subject-hours">0 hours</div>
                    </div>
                    <div class="stat-card">
                        <h3>Study Days</h3>
                        <div class="stat-value" id="study-days">0</div>
                        <div>days this month</div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3>Subject Breakdown</h3>
                    <div id="subject-chart" style="height: 300px; background-color: #f8f4e9; padding: 20px; border-radius: 5px; border: 1px solid #d4c9b8;">
                        <!-- Chart will be rendered here -->
                        <p>No data available for this month.</p>
                    </div>
                </div>
            </div>
            
            <!-- Weekly Stats -->
            <div id="weekly-stats" class="stats-tab-content">
                <h2>Weekly Study Statistics</h2>
                <div class="week-selector">
                    <button id="prev-week-stats">&lt; Previous</button>
                    <div class="week-title" id="current-week-stats">Week of Month Day</div>
                    <button id="next-week-stats">Next &gt;</button>
                </div>
                <div class="stats-container">
                    <div class="stat-card">
                        <h3>Total Study Time</h3>
                        <div class="stat-value" id="weekly-total-hours">0 hours</div>
                        <div>this week</div>
                    </div>
                    <div class="stat-card">
                        <h3>Goal Progress</h3>
                        <div id="goal-progress-container">
                            <!-- Goal progress will be added here -->
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3>Weekly Subject Breakdown</h3>
                    <div id="weekly-subject-chart" style="height: 300px; background-color: #f8f4e9; padding: 20px; border-radius: 5px; border: 1px solid #d4c9b8;">
                        <!-- Chart will be rendered here -->
                        <p>No data available for this week.</p>
                    </div>
                </div>
            </div>
            
            <button class="export-btn" onclick="exportToExcel()">Export Study Data to Excel</button>
        </div>
        
        <!-- Goals Tab -->
        <div id="goals" class="tab-content">
            <div class="goals-container">
                <h2>Weekly Study Goals</h2>
                <p>Set your weekly study goals for each subject:</p>
                
                <div id="goals-list">
                    <div class="goal-item">
                        <label for="goal-TMUA">TMUA:</label>
                        <input type="number" id="goal-TMUA" min="0" step="0.1" placeholder="Hours">
                    </div>
                    <div class="goal-item">
                        <label for="goal-A-Level">A Level:</label>
                        <input type="number" id="goal-A-Level" min="0" step="0.1" placeholder="Hours">
                    </div>
                    <div class="goal-item">
                        <label for="goal-R">R:</label>
                        <input type="number" id="goal-R" min="0" step="0.1" placeholder="Hours">
                    </div>
                    <div class="goal-item">
                        <label for="goal-Python">Python:</label>
                        <input type="number" id="goal-Python" min="0" step="0.1" placeholder="Hours">
                    </div>
                    <div class="goal-item">
                        <label for="goal-Other">Other:</label>
                        <input type="number" id="goal-Other" min="0" step="0.1" placeholder="Hours">
                    </div>
                </div>
                
                <button onclick="saveGoals()" style="margin-top: 15px;">Save Goals</button>
            </div>
            
            <div class="goals-container" style="margin-top: 20px;">
                <h3>Current Goals</h3>
                <div id="current-goals-display">
                    <!-- Current goals will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for viewing entry details -->
    <div id="entry-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Entry Details</h3>
                <span class="close-modal" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Content will be added dynamically -->
            </div>
            <div class="modal-footer">
                <button onclick="closeModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Current date and view
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        let currentWeek = getWeekNumber(currentDate);
        
        // Data storage
        let studyEntries = JSON.parse(localStorage.getItem('studyEntries')) || [];
        let todoItems = JSON.parse(localStorage.getItem('todoItems')) || [];
        let studyGoals = JSON.parse(localStorage.getItem('studyGoals')) || {
            'TMUA': 0,
            'A-Level': 0,
            'R': 0,
            'Python': 0,
            'Other': 0
        };
        
        // DOM Elements
        const calendarBody = document.getElementById('calendar-body');
        const currentMonthElement = document.getElementById('current-month');
        const currentMonthStatsElement = document.getElementById('current-month-stats');
        const currentWeekStatsElement = document.getElementById('current-week-stats');
        const entryForm = document.getElementById('entry-form');
        const todoForm = document.getElementById('todo-form');
        const todoList = document.getElementById('todo-list');
        const totalHoursElement = document.getElementById('total-hours');
        const topSubjectElement = document.getElementById('top-subject');
        const topSubjectHoursElement = document.getElementById('top-subject-hours');
        const studyDaysElement = document.getElementById('study-days');
        const subjectChartElement = document.getElementById('subject-chart');
        const weeklySubjectChartElement = document.getElementById('weekly-subject-chart');
        const weeklyTotalHoursElement = document.getElementById('weekly-total-hours');
        const goalProgressContainer = document.getElementById('goal-progress-container');
        const currentGoalsDisplay = document.getElementById('current-goals-display');
        const subjectSelect = document.getElementById('entry-subject');
        const otherSubjectContainer = document.getElementById('other-subject-container');
        const modal = document.getElementById('entry-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            generateCalendar(currentMonth, currentYear);
            updateMonthDisplay();
            updateWeekDisplay();
            renderTodoList();
            loadGoals();
            displayCurrentGoals();
            
            // Load today's date in the forms
            document.getElementById('entry-date').valueAsDate = new Date();
            document.getElementById('todo-due-date').valueAsDate = new Date();
            
            // Event listeners for subject selection
            subjectSelect.addEventListener('change', function() {
                if (this.value === 'Other') {
                    otherSubjectContainer.style.display = 'block';
                } else {
                    otherSubjectContainer.style.display = 'none';
                }
            });
            
            // Month navigation for calendar
            document.getElementById('prev-month').addEventListener('click', function() {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                generateCalendar(currentMonth, currentYear);
                updateMonthDisplay();
            });
            
            document.getElementById('next-month').addEventListener('click', function() {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                generateCalendar(currentMonth, currentYear);
                updateMonthDisplay();
            });
            
            // Month navigation for stats
            document.getElementById('prev-month-stats').addEventListener('click', function() {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                updateStats();
                updateMonthDisplay();
            });
            
            document.getElementById('next-month-stats').addEventListener('click', function() {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                updateStats();
                updateMonthDisplay();
            });
            
            // Week navigation for stats
            document.getElementById('prev-week-stats').addEventListener('click', function() {
                currentWeek--;
                if (currentWeek < 1) {
                    currentWeek = 52;
                    currentYear--;
                }
                updateWeekStats();
                updateWeekDisplay();
            });
            
            document.getElementById('next-week-stats').addEventListener('click', function() {
                currentWeek++;
                if (currentWeek > 52) {
                    currentWeek = 1;
                    currentYear++;
                }
                updateWeekStats();
                updateWeekDisplay();
            });
            
            // Form submission for study entries
            entryForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const date = document.getElementById('entry-date').value;
                let subject = document.getElementById('entry-subject').value;
                const topic = document.getElementById('entry-topic').value;
                const duration = parseFloat(document.getElementById('entry-duration').value);
                
                // Handle "Other" subject
                if (subject === 'Other') {
                    const otherSubject = document.getElementById('other-subject').value.trim();
                    if (otherSubject) {
                        subject = otherSubject;
                    } else {
                        alert('Please specify the other subject');
                        return;
                    }
                }
                
                const newEntry = {
                    id: Date.now(), // Unique ID for each entry
                    date: date,
                    subject: subject,
                    topic: topic,
                    duration: duration
                };
                
                studyEntries.push(newEntry);
                saveEntries();
                
                // Reset form
                entryForm.reset();
                document.getElementById('entry-date').valueAsDate = new Date();
                otherSubjectContainer.style.display = 'none';
                
                // Update calendar and stats
                generateCalendar(currentMonth, currentYear);
                updateStats();
                updateWeekStats();
                
                alert('Entry added successfully!');
            });
            
            // Form submission for todo items
            todoForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const task = document.getElementById('todo-task').value.trim();
                const dueDate = document.getElementById('todo-due-date').value;
                
                if (!task) {
                    alert('Please enter a task');
                    return;
                }
                
                if (!dueDate) {
                    alert('Please select a due date');
                    return;
                }
                
                const newTodo = {
                    id: Date.now(),
                    task: task,
                    dueDate: dueDate,
                    completed: false,
                    createdAt: new Date().toISOString()
                };
                
                todoItems.push(newTodo);
                saveTodos();
                renderTodoList();
                generateCalendar(currentMonth, currentYear);
                
                // Reset form
                todoForm.reset();
                document.getElementById('todo-due-date').valueAsDate = new Date();
            });
            
            // Initialize stats
            updateStats();
            updateWeekStats();
        });
        
        // Save entries to localStorage
        function saveEntries() {
            localStorage.setItem('studyEntries', JSON.stringify(studyEntries));
        }
        
        // Save todos to localStorage
        function saveTodos() {
            localStorage.setItem('todoItems', JSON.stringify(todoItems));
        }
        
        // Save goals to localStorage
        function saveGoals() {
            studyGoals = {
                'TMUA': parseFloat(document.getElementById('goal-TMUA').value) || 0,
                'A-Level': parseFloat(document.getElementById('goal-A-Level').value) || 0,
                'R': parseFloat(document.getElementById('goal-R').value) || 0,
                'Python': parseFloat(document.getElementById('goal-Python').value) || 0,
                'Other': parseFloat(document.getElementById('goal-Other').value) || 0
            };
            localStorage.setItem('studyGoals', JSON.stringify(studyGoals));
            displayCurrentGoals();
            updateWeekStats();
            alert('Goals saved successfully!');
        }
        
        // Load goals from localStorage
        function loadGoals() {
            document.getElementById('goal-TMUA').value = studyGoals['TMUA'] || '';
            document.getElementById('goal-A-Level').value = studyGoals['A-Level'] || '';
            document.getElementById('goal-R').value = studyGoals['R'] || '';
            document.getElementById('goal-Python').value = studyGoals['Python'] || '';
            document.getElementById('goal-Other').value = studyGoals['Other'] || '';
        }
        
        // Display current goals
        function displayCurrentGoals() {
            let html = '<ul>';
            for (const subject in studyGoals) {
                if (studyGoals[subject] > 0) {
                    html += `<li><strong>${subject}:</strong> ${studyGoals[subject]} hours per week</li>`;
                }
            }
            html += '</ul>';
            
            if (html === '<ul></ul>') {
                html = '<p>No goals set yet.</p>';
            }
            
            currentGoalsDisplay.innerHTML = html;
        }
        
        // Delete an entry
        function deleteEntry(entryId) {
            if (confirm('Are you sure you want to delete this entry?')) {
                studyEntries = studyEntries.filter(entry => entry.id !== entryId);
                saveEntries();
                generateCalendar(currentMonth, currentYear);
                updateStats();
                updateWeekStats();
            }
        }
        
        // Toggle todo completion status
        function toggleTodoCompletion(todoId) {
            const todo = todoItems.find(item => item.id === todoId);
            if (todo) {
                todo.completed = !todo.completed;
                saveTodos();
                renderTodoList();
                generateCalendar(currentMonth, currentYear);
            }
        }
        
        // Delete a todo item
        function deleteTodo(todoId) {
            if (confirm('Are you sure you want to delete this task?')) {
                todoItems = todoItems.filter(item => item.id !== todoId);
                saveTodos();
                renderTodoList();
                generateCalendar(currentMonth, currentYear);
            }
        }
        
        // Show modal with entry details
        function showEntryDetails(entryId, isTodo = false) {
            if (isTodo) {
                const todo = todoItems.find(item => item.id === entryId);
                if (todo) {
                    modalTitle.textContent = 'To-Do Details';
                    modalBody.innerHTML = `
                        <p><strong>Task:</strong> ${todo.task}</p>
                        <p><strong>Due Date:</strong> ${formatDisplayDate(todo.dueDate)}</p>
                        <p><strong>Status:</strong> ${todo.completed ? 'Completed' : 'Pending'}</p>
                        <p><strong>Created:</strong> ${formatDisplayDate(todo.createdAt)}</p>
                    `;
                }
            } else {
                const entry = studyEntries.find(item => item.id === entryId);
                if (entry) {
                    modalTitle.textContent = 'Study Entry Details';
                    modalBody.innerHTML = `
                        <p><strong>Date:</strong> ${formatDisplayDate(entry.date)}</p>
                        <p><strong>Subject:</strong> ${entry.subject}</p>
                        <p><strong>Topic:</strong> ${entry.topic || 'No topic specified'}</p>
                        <p><strong>Duration:</strong> ${entry.duration} hours</p>
                    `;
                }
            }
            modal.style.display = 'block';
        }
        
        // Close modal
        function closeModal() {
            modal.style.display = 'none';
        }
        
        // Close modal when clicking outside of it
        window.onclick = function(event) {
            if (event.target == modal) {
                closeModal();
            }
        }
        
        // Render the todo list
        function renderTodoList() {
            todoList.innerHTML = '';
            
            if (todoItems.length === 0) {
                todoList.innerHTML = '<p>No tasks yet. Add one above!</p>';
                return;
            }
            
            // Sort by completion status and due date
            todoItems.sort((a, b) => {
                if (a.completed !== b.completed) {
                    return a.completed ? 1 : -1;
                }
                return new Date(a.dueDate) - new Date(b.dueDate);
            });
            
            todoItems.forEach(todo => {
                const li = document.createElement('li');
                li.className = `todo-item ${todo.completed ? 'completed' : ''}`;
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = todo.completed;
                checkbox.addEventListener('change', () => toggleTodoCompletion(todo.id));
                
                const taskSpan = document.createElement('span');
                taskSpan.className = 'task';
                taskSpan.textContent = todo.task;
                
                const dueDateSpan = document.createElement('span');
                dueDateSpan.className = 'due-date';
                dueDateSpan.textContent = `Due: ${formatDisplayDate(todo.dueDate)}`;
                
                const deleteBtn = document.createElement('span');
                deleteBtn.className = 'delete-todo';
                deleteBtn.innerHTML = '&times;';
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteTodo(todo.id);
                });
                
                li.appendChild(checkbox);
                li.appendChild(taskSpan);
                li.appendChild(dueDateSpan);
                li.appendChild(deleteBtn);
                
                // Click on the entire item to view details
                li.addEventListener('click', (e) => {
                    if (e.target !== checkbox && e.target !== deleteBtn) {
                        showEntryDetails(todo.id, true);
                    }
                });
                
                todoList.appendChild(li);
            });
        }
        
        // Format date for display
        function formatDisplayDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }
        
        // Get week number of the year
        function getWeekNumber(date) {
            const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
            const pastDaysOfYear = (date - firstDayOfYear) / 86400000;
            return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
        }
        
        // Get dates for a specific week number
        function getDatesOfWeek(weekNo, year) {
            const firstDayOfYear = new Date(year, 0, 1);
            const daysToAdd = (weekNo - 1) * 7;
            const firstDayOfWeek = new Date(firstDayOfYear);
            firstDayOfWeek.setDate(firstDayOfYear.getDate() + daysToAdd - firstDayOfYear.getDay());
            
            const dates = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date(firstDayOfWeek);
                date.setDate(firstDayOfWeek.getDate() + i);
                dates.push(date);
            }
            return dates;
        }
        
        // Generate calendar
        function generateCalendar(month, year) {
            calendarBody.innerHTML = '';
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            
            let date = 1;
            let dayOfWeek = firstDay.getDay();
            
            // Create calendar rows
            for (let i = 0; i < 6; i++) {
                if (date > daysInMonth) break;
                
                const row = document.createElement('tr');
                
                // Create cells for each day of the week
                for (let j = 0; j < 7; j++) {
                    const cell = document.createElement('td');
                    
                    if (i === 0 && j < dayOfWeek) {
                        // Days from previous month
                        const prevMonthLastDay = new Date(year, month, 0).getDate();
                        const prevDate = prevMonthLastDay - (dayOfWeek - j - 1);
                        
                        cell.innerHTML = `<div class="date">${prevDate}</div>`;
                        cell.classList.add('other-month');
                    } else if (date > daysInMonth) {
                        // Days from next month
                        const nextDate = date - daysInMonth;
                        
                        cell.innerHTML = `<div class="date">${nextDate}</div>`;
                        cell.classList.add('other-month');
                        date++;
                    } else {
                        // Current month days
                        cell.innerHTML = `<div class="date">${date}</div>`;
                        
                        // Highlight today
                        const today = new Date();
                        if (date === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                            cell.classList.add('today');
                        }
                        
                        // Add study entries for this date
                        const currentDateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                        const dateEntries = studyEntries.filter(entry => entry.date === currentDateStr);
                        
                        dateEntries.forEach(entry => {
                            const entryDiv = document.createElement('div');
                            entryDiv.className = `calendar-entry ${getSubjectColorClass(entry.subject)}`;
                            entryDiv.innerHTML = `
                                ${entry.subject} (${entry.duration}h)
                                <span class="delete-entry" onclick="event.stopPropagation(); deleteEntry(${entry.id})">&times;</span>
                            `;
                            entryDiv.addEventListener('click', (e) => {
                                if (e.target !== entryDiv.querySelector('.delete-entry')) {
                                    showEntryDetails(entry.id, false);
                                }
                            });
                            cell.appendChild(entryDiv);
                        });
                        
                        // Add todo items for this date
                        const dateTodos = todoItems.filter(todo => todo.dueDate === currentDateStr);
                        dateTodos.forEach(todo => {
                            const todoDiv = document.createElement('div');
                            todoDiv.className = 'calendar-entry Todo';
                            todoDiv.innerHTML = `
                                ${todo.completed ? '✓ ' : ''}${todo.task}
                                <span class="delete-entry" onclick="event.stopPropagation(); deleteTodo(${todo.id})">&times;</span>
                            `;
                            todoDiv.addEventListener('click', (e) => {
                                if (e.target !== todoDiv.querySelector('.delete-entry')) {
                                    showEntryDetails(todo.id, true);
                                }
                            });
                            cell.appendChild(todoDiv);
                        });
                        
                        date++;
                    }
                    
                    row.appendChild(cell);
                }
                
                calendarBody.appendChild(row);
            }
        }
        
        // Update month display
        function updateMonthDisplay() {
            const monthNames = ["January", "February", "March", "April", "May", "June",
                                "July", "August", "September", "October", "November", "December"];
            currentMonthElement.textContent = `${monthNames[currentMonth]} ${currentYear}`;
            currentMonthStatsElement.textContent = `${monthNames[currentMonth]} ${currentYear}`;
        }
        
        // Update week display
        function updateWeekDisplay() {
            const dates = getDatesOfWeek(currentWeek, currentYear);
            const startDate = dates[0];
            const endDate = dates[6];
            
            const monthNames = ["January", "February", "March", "April", "May", "June",
                              "July", "August", "September", "October", "November", "December"];
            
            const startMonth = monthNames[startDate.getMonth()];
            const endMonth = monthNames[endDate.getMonth()];
            
            let displayText;
            if (startMonth === endMonth) {
                displayText = `Week of ${startMonth} ${startDate.getDate()} - ${endDate.getDate()}, ${currentYear}`;
            } else {
                displayText = `Week of ${startMonth} ${startDate.getDate()} - ${endMonth} ${endDate.getDate()}, ${currentYear}`;
            }
            
            currentWeekStatsElement.textContent = displayText;
        }
        
        // Update statistics
        function updateStats() {
            const monthStart = new Date(currentYear, currentMonth, 1);
            const monthEnd = new Date(currentYear, currentMonth + 1, 0);
            
            // Format dates for comparison
            const monthStartStr = formatDate(monthStart);
            const monthEndStr = formatDate(monthEnd);
            
            // Filter entries for current month
            const monthEntries = studyEntries.filter(entry => {
                return entry.date >= monthStartStr && entry.date <= monthEndStr;
            });
            
            // Calculate total hours
            const totalHours = monthEntries.reduce((sum, entry) => sum + entry.duration, 0);
            totalHoursElement.textContent = `${totalHours.toFixed(1)} hours`;
            
            // Calculate by subject
            const subjects = {};
            monthEntries.forEach(entry => {
                if (!subjects[entry.subject]) {
                    subjects[entry.subject] = 0;
                }
                subjects[entry.subject] += entry.duration;
            });
            
            // Find top subject
            let topSubject = '-';
            let topSubjectHours = 0;
            
            for (const subject in subjects) {
                if (subjects[subject] > topSubjectHours) {
                    topSubject = subject;
                    topSubjectHours = subjects[subject];
                }
            }
            
            topSubjectElement.textContent = topSubject;
            topSubjectHoursElement.textContent = `${topSubjectHours.toFixed(1)} hours`;
            
            // Count study days
            const uniqueDays = new Set(monthEntries.map(entry => entry.date));
            studyDaysElement.textContent = uniqueDays.size;
            
            // Update chart
            updateTextChart(subjects, subjectChartElement);
        }
        
        // Update weekly statistics
        function updateWeekStats() {
            const dates = getDatesOfWeek(currentWeek, currentYear);
            const weekStart = dates[0];
            const weekEnd = dates[6];
            
            // Format dates for comparison
            const weekStartStr = formatDate(weekStart);
            const weekEndStr = formatDate(weekEnd);
            
            // Filter entries for current week
            const weekEntries = studyEntries.filter(entry => {
                return entry.date >= weekStartStr && entry.date <= weekEndStr;
            });
            
            // Calculate total hours
            const totalHours = weekEntries.reduce((sum, entry) => sum + entry.duration, 0);
            weeklyTotalHoursElement.textContent = `${totalHours.toFixed(1)} hours`;
            
            // Calculate by subject
            const subjects = {};
            weekEntries.forEach(entry => {
                const baseSubject = getBaseSubject(entry.subject);
                if (!subjects[baseSubject]) {
                    subjects[baseSubject] = 0;
                }
                subjects[baseSubject] += entry.duration;
            });
            
            // Update goal progress
            updateGoalProgress(subjects);
            
            // Update chart
            updateTextChart(subjects, weeklySubjectChartElement);
        }
        
        // Update goal progress display
        function updateGoalProgress(subjects) {
            goalProgressContainer.innerHTML = '';
            
            for (const subject in studyGoals) {
                if (studyGoals[subject] > 0) {
                    const hoursStudied = subjects[subject] || 0;
                    const goalHours = studyGoals[subject];
                    const percentage = Math.min(100, (hoursStudied / goalHours) * 100);
                    
                    const progressDiv = document.createElement('div');
                    progressDiv.style.marginBottom = '15px';
                    progressDiv.innerHTML = `
                        <p><strong>${subject}:</strong> ${hoursStudied.toFixed(1)} / ${goalHours} hours</p>
                        <div class="progress-bar">
                            <div class="progress" style="width: ${percentage}%"></div>
                        </div>
                    `;
                    
                    goalProgressContainer.appendChild(progressDiv);
                }
            }
            
            if (goalProgressContainer.innerHTML === '') {
                goalProgressContainer.innerHTML = '<p>No goals set for this week.</p>';
            }
        }
        
        // Get base subject (for goal tracking)
        function getBaseSubject(subject) {
            const baseSubjects = ['TMUA', 'A-Level', 'R', 'Python', 'Other'];
            return baseSubjects.includes(subject) ? subject : 'Other';
        }
        
        // Format date as YYYY-MM-DD
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // Simple text-based chart
        function updateTextChart(subjects, element) {
            if (Object.keys(subjects).length === 0) {
                element.innerHTML = '<p>No data available.</p>';
                return;
            }
            
            let html = '<div style="display: flex; flex-direction: column; gap: 10px;">';
            
            // Sort subjects by hours (descending)
            const sortedSubjects = Object.keys(subjects).sort((a, b) => subjects[b] - subjects[a]);
            
            for (const subject of sortedSubjects) {
                const hours = subjects[subject];
                const totalHours = Object.values(subjects).reduce((a, b) => a + b, 0);
                const percentage = totalHours > 0 ? (hours / totalHours) * 100 : 0;
                
                html += `
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span><strong>${subject}</strong></span>
                            <span>${hours.toFixed(1)} hours (${percentage.toFixed(1)}%)</span>
                        </div>
                        <div style="height: 20px; background-color: #e0e0e0; border-radius: 10px;">
                            <div style="height: 100%; width: ${percentage}%; background-color: ${getSubjectColor(subject)}; border-radius: 10px;"></div>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            element.innerHTML = html;
        }
        
        // Get color for a subject
        function getSubjectColor(subject) {
            const baseSubject = subject.split(' ')[0]; // In case of "Other" subjects
            switch(baseSubject) {
                case 'TMUA': return '#a5c4b8';
                case 'A-Level': return '#d4b8a5';
                case 'R': return '#b8a5c4';
                case 'Python': return '#a5b8c4';
                default: return '#c4c4a5';
            }
        }
        
        function getSubjectColorClass(subject) {
            const baseSubject = subject.split(' ')[0];
            switch(baseSubject) {
                case 'TMUA': return 'TMUA';
                case 'A-Level': return 'A-Level';
                case 'R': return 'R';
                case 'Python': return 'Python';
                default: return 'Other';
            }
        }
        
        // Export data to Excel (only study entries)
        function exportToExcel() {
            // Prepare study data
            const studyData = studyEntries.map(entry => ({
                Date: entry.date,
                Subject: entry.subject,
                Topic: entry.topic || '',
                'Duration (hours)': entry.duration
            }));
            
            // Create CSV content
            let csvContent = "data:text/csv;charset=utf-8,";
            
            // Add headers
            csvContent += Object.keys(studyData[0] || {}).join(",") + "\r\n";
            
            // Add data rows
            studyData.forEach(row => {
                csvContent += Object.values(row).map(field => `"${field}"`).join(",") + "\r\n";
            });
            
            // Create download link
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `learning_journal_study_data_${formatDate(new Date())}.csv`);
            document.body.appendChild(link);
            
            // Trigger download
            link.click();
            document.body.removeChild(link);
        }
        
        // Tab switching
        function openTab(tabId) {
            // Hide all tab contents
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // Remove active class from all tabs
            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // Show the selected tab content and mark tab as active
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
            
            // If switching to stats tab, update stats
            if (tabId === 'stats') {
                updateStats();
                updateWeekStats();
            }
        }
        
        // Stats tab switching
        function openStatsTab(tabId) {
            // Hide all stats tab contents
            const statsTabContents = document.getElementsByClassName('stats-tab-content');
            for (let i = 0; i < statsTabContents.length; i++) {
                statsTabContents[i].classList.remove('active');
            }
            
            // Remove active class from all stats tabs
            const statsTabs = document.querySelectorAll('#stats .tab');
            for (let i = 0; i < statsTabs.length; i++) {
                statsTabs[i].classList.remove('active');
            }
            
            // Show the selected stats tab content and mark tab as active
            document.getElementById(`${tabId}-stats`).classList.add('active');
            event.currentTarget.classList.add('active');
            
            // Update the appropriate stats
            if (tabId === 'monthly') {
                updateStats();
            } else {
                updateWeekStats();
            }
        }
    </script>
</body>
</html>